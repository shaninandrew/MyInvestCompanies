@page "/"

@using MyInvestCompanies;
@using MyInvestCompanies.модель_данных;


@code{
   public Database_structure db_index = new Database_structure();

}

Компании
<button @onclick="Add_company">Добавить компанию </button> <br/>
@code{ 
        List<string> NameX=new List<string>(); 
    }
<div class="scroll">
    <div style="height:350px;">
@foreach  (Company c in db_index.Companies)
        {
         
            NameX.Add("Name");
            <input type="text" value="@c.Name"                                      @onchange="(e=> {  Set_value(NameX[0], c.Id.ToString(), e.Value.ToString() , e);  })" />
            NameX.Add("Founded");
            <input type="date" value="@c.Founded.Date.ToString("yyyy-MM-dd")"       @onchange="(e=> {  Set_value(NameX[1], c.Id.ToString(), e.Value.ToString() , e);  })"/>      
            NameX.Add("Address");
            <input type="text" value="@c.Address"                                   @onchange="(e=> {  Set_value(NameX[2], c.Id.ToString(), e.Value.ToString() , e);  })"/>     
            NameX.Add("Fact_Address");
            <input type="text" value="@c.Fact_Address"                              @onchange="(e=> {  Set_value(NameX[3], c.Id.ToString(), e.Value.ToString() , e);  })" />
            NameX.Add("Description");
            <input type="text" value="@c.Description"                               @onchange="(e=> {  Set_value(NameX[4], c.Id.ToString(), e.Value.ToString() , e);  })" />
            NameX.Add("Inn");
            <input type="text" value="@c.Inn"                                       @onchange="(e=> {  Set_value(NameX[5], c.Id.ToString(), e.Value.ToString() , e);  })"/>          
            NameX.Add("KPP");
            <input type="text" value="@c.KPP"                                       @onchange="(e=> {  Set_value(NameX[6], c.Id.ToString(), e.Value.ToString() , e);  })" />         
            <button  @onclick="(e=> {Delete_company(c.Id.ToString()) ;} )">-</button>
            <br>
        
        }
    </div>
</div>
@code{
        static public  EventCallback Delete_company(string id)
        {
            Database_structure db = new Database_structure();
            Company c = db.Companies.Where<Company>(i => i.Id == id).Single<Company>();
            db.Companies.Remove(c);
            db.SaveChanges();
            db.Dispose();

            return (new EventCallback());
        }

        static public void  Add_company()
        {

            Database_structure db = new Database_structure();
            Company c = new Company();
            c.Name = "???";
            db.Companies.Add(c);
            db.SaveChanges();
            db.Dispose();
        }

        static public EventCallback Set_value(string name, string id, string value, ChangeEventArgs? e)// (object sender, ChangeEventArgs e)//(string name, string id)
        {
            
            Console.WriteLine($"Установка значения {name} id={id}: {value}");
            Database_structure db = new Database_structure();

            var t= db.Companies.Where<Company>(i => i.Id == id).Single<Company>();

            if (name == "Name")
                 { t.Name = e.Value.ToString(); }
            if (name == "Founded")
                 { t.Founded = DateTime.Parse( e.Value.ToString()); }
            if (name == "Address")
                 { t.Address = e.Value.ToString(); }
            if (name == "Fact_Address")
                 { t.Fact_Address = e.Value.ToString(); }
            if (name == "Description")
                 { t.Description = e.Value.ToString(); }
            if (name == "Inn")
                { t.Inn = e.Value.ToString(); }
            if (name == "KPP")
                  { t.KPP = e.Value.ToString(); }

            db.SaveChanges();
            db.Dispose();
            return (new EventCallback());
        }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        


}
